# Тестовое задание PHP 4people

## Минимальные требования

- php8.1
- node 18.2.0
- composer 2


## Установка

- `composer install`
- `npm install`
- Из файла `.env.exapmle` создать `.env` с минимально-необходимым набором настроек (необходима БД)
- `php artisan migrate`
- `php artisan serve`
- `npm run build`, либо `npm run dev`
- Открыть в брузере `http://127.0.0.1:8000`


## Общая информация

### Бизнес логика

Бизнес логика парсинга новостного сайта заключена в сервисе `App\Services\HtmlParser\HtmlParser`. У сервиса 
есть возможность кэширования результатов запросов к URL сайта с новостями (включено по умолчанию). Настройки 
селекторов информационных блоков 
страницы со списком новостей и страницы самой новости осуществлются в классе `App\Services\NewsResources\Rbc`, 
который реализует интерфейс `App\Services\NewsResources\Contracts\NewsResourceInterface` (геттеры и сеттеры 
реализованы в трейте `App\Services\NewsResources\Traits\NewsResourceable`). Соответственно для добавления нового 
новостного ресурса необходимо создать класс реализующий вышеописанный интерфейс и указать в нем свойства с 
соответствующими селекторами.

### Парсинг новостей

Парсинг новостей реализован в Job'е `App\Jobs\FetchNewsJob`. По умолчанию в `.env` файле установлено синхронное 
выполнение Job'ов.


## UI

По адресу `http://127.0.0.1:8000/news_items` доступен список новостей с пагинацией (параметр `page`). Отдельные 
страницы 
новостей 
доступны по 
адресу `http://127.0.0.1:8000/news_items/{:id}`, где `id` ID новости.


## API

### GET `/api/news_items`

Возвращает список новостей в json

#### Пример

GET `http://127.0.0.1:8000/api/news_items`

#### Успешный ответ

```
HTTP Status 200
{
    "data": [
        {
            "id": 71,
            "title": "Профилактика мании: как снизить зависимость от азартных игр среди россиян",
            "slug": "Среди ученых нет единого мнения по поводу того, что именно толкает людей к рулетке, картам и игровым автоматам. Одни игроки видят в своем занятии способ разбогатеть, другие пытаются избавиться от скук...",
            "rating": 3,
            "link": "http://127.0.0.1:8000/news_items/71"
        },
        {
            "id": 72,
            "title": "Шлеменко словами «ему рано на покой» оценил поражение 51-летнего Монсона",
            "slug": "Бывший чемпион Bellator отметил, что после победы над Джеффом Монсоном Вячеслава Дацика можно назвать абсолютным фаворитом в его грядущем поединке с Александром Емельяненко Читайте нас в Новости Новос...",
            "rating": 8,
            "link": "http://127.0.0.1:8000/news_items/72"
        },
        ...
        {
            "id": 94,
            "title": "В Крыму назвали предварительную сумму ущерба от взрывов в Новофедоровке",
            "slug": "Пострадавшими признали 62 многоквартирных дома и 20 коммерческих объектов, а обход частных домов в Новофедоровке продолжается, сообщил глава Крыма Аксенов Фото: ТАСС Гражданский ущерб от взрывов в Нов...",
            "rating": 1,
            "link": "http://127.0.0.1:8000/news_items/94"
        }
    ],
    "links": {
        "first": "http://127.0.0.1:8000/api/news_items?page=1",
        "last": "http://127.0.0.1:8000/api/news_items?page=2",
        "prev": null,
        "next": "http://127.0.0.1:8000/api/news_items?page=2"
    },
    "meta": {
        "current_page": 1,
        "from": 1,
        "last_page": 2,
        "links": [
            {
                "url": null,
                "label": "&laquo; Previous",
                "active": false
            },
            {
                "url": "http://127.0.0.1:8000/api/news_items?page=1",
                "label": "1",
                "active": true
            },
            {
                "url": "http://127.0.0.1:8000/api/news_items?page=2",
                "label": "2",
                "active": false
            },
            {
                "url": "http://127.0.0.1:8000/api/news_items?page=2",
                "label": "Next &raquo;",
                "active": false
            }
        ],
        "path": "http://127.0.0.1:8000/api/news_items",
        "per_page": 15,
        "to": 15,
        "total": 28
    }
}
```

### PUT `/api/news_items/{:id}`

Обновление рейтинга новости

#### Параметры

`rating` - рейтинг (целое число)

#### Пример

PUT `http://127.0.0.1:8000/api/news_items/1?rating=5`

#### Успешный ответ

```HTTP Status 200```

### GET `/api/news_items/fetch`

Поставить задачу на загрузку новых новостей

#### Пример

GET `http://127.0.0.1:8000/api/news_items/fetch`

#### Успешный ответ

```
HTTP Status 200
{
    "data": "Задача на загрузку новостей поставлена в очередь"
}
```


